<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Recherche de trajets – JaalibaDaily</title>
  <link rel="stylesheet" href="assets/css/style.css">

  <style>
    .results {
      margin-top: 1.5rem;
    }
    .trip-card {
      background: white;
      padding: 1rem;
      border-radius: 14px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.09);
      border: 1px solid rgba(148,163,184,0.3);
      margin-bottom: 1rem;
    }
    .trip-header {
      font-weight: 700;
      font-size: 1.1rem;
    }
    .trip-meta {
      margin-top: .4rem;
      font-size: .9rem;
      color: var(--muted);
    }
    .reserve-btn {
      margin-top: .8rem;
      width: 100%;
    }
  </style>
</head>

<body>

<header>
  <nav class="nav">
    <div class="logo">
      <div class="logo-icon">JD</div>
      <span>JaalibaDaily</span>
    </div>

    <div class="nav-right" id="navRight"></div>
  </nav>
</header>


<div class="container">

  <h2 class="center">Rechercher un trajet</h2>

  <form id="searchForm" class="form-card">

    <div>
      <label>Départ</label>
      <input id="from" type="text" placeholder="Matoto, Cosa, Kipé...">
    </div>

    <div>
      <label>Arrivée</label>
      <input id="to" type="text" placeholder="Kaloum, Lambanyi, Sonfonia...">
    </div>

    <div>
      <label>Date</label>
      <input id="date" type="date">
    </div>

    <button class="btn btn-primary" type="button" onclick="searchTrips()">Rechercher</button>

  </form>

  <div id="results" class="results"></div>

</div>

<script>
// Vérifier si utilisateur est connecté
let currentUser = JSON.parse(localStorage.getItem("currentUser"));
if (!currentUser) {
  alert("Vous devez être connecté pour rechercher un trajet.");
  window.location.href = "connexion.html";
}

// Charger les trajets
let trips = JSON.parse(localStorage.getItem("trips")) || [];

/* --- Recherche --- */
function searchTrips() {
  const from = document.getElementById("from").value.trim().toLowerCase();
  const to = document.getElementById("to").value.trim().toLowerCase();
  const date = document.getElementById("date").value;

  let results = trips.filter(t => {
    return (
      (from === "" || t.from.toLowerCase().includes(from)) &&
      (to === "" || t.to.toLowerCase().includes(to)) &&
      (date === "" || t.date === date)
    );
  });

  displayResults(results);
}

/* --- Affichage des résultats --- */
function displayResults(list) {
  const container = document.getElementById("results");
  container.innerHTML = "";

  if (list.length === 0) {
    container.innerHTML = "<p>Aucun trajet trouvé.</p>";
    return;
  }

  list.forEach(t => {
    container.innerHTML += `
      <div class="trip-card">
        <div class="trip-header">${t.from} → ${t.to}</div>
        <div class="trip-meta">
          Date : ${t.date}<br>
          Places : ${t.seats}<br>
          Prix : ${t.price} GNF<br>
          Conducteur : ${t.owner}
        </div>

        <button class="btn btn-primary reserve-btn" onclick="reserve(${t.id})">
          Réserver ce trajet
        </button>
      </div>
    `;
  });
}

/* --- Réserver un trajet --- */
function reserve(id) {
  let bookings = JSON.parse(localStorage.getItem("bookings")) || [];

  // vérifier si déjà réservé
  if (bookings.some(b => b.tripId === id && b.user === currentUser.email)) {
    alert("Vous avez déjà réservé ce trajet.");
    return;
  }

  bookings.push({
    bookingId: Date.now(),
    tripId: id,
    user: currentUser.email
  });

  localStorage.setItem("bookings", JSON.stringify(bookings));

  alert("Trajet réservé avec succès !");
}

</script>

</body>
</html>
