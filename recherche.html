<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Recherche de trajets – JaalibaDaily</title>
  <link rel="stylesheet" href="assets/css/style.css">

 <div style="
    max-width: 900px;
    margin: 3rem auto;
    padding: 2rem 2.5rem;
    background: white;
    border-radius: 24px;
    box-shadow: var(--shadow-soft);
    border: 1px solid rgba(148,163,184,0.25);
">

    <h2 style="text-align:center; font-size:2rem; margin-bottom:1.5rem; font-weight:700;">
        Rechercher un trajet
    </h2>

    <form id="searchForm" class="form-card">

        <div>
            <label>Départ</label>
            <input id="from" type="text" placeholder="Matoto, Cosa, Kipé..." required>
        </div>

        <div>
            <label>Arrivée</label>
            <input id="to" type="text" placeholder="Kaloum, Lambanyi, Sonfonia..." required>
        </div>

        <div>
            <label>Date</label>
            <input id="date" type="date" required>
        </div>

        <button class="btn btn-primary" type="button" style="margin-top:1rem; width:100%;" onclick="searchTrips()">
            Rechercher
        </button>
    </form>

    <div id="results" class="results" style="margin-top:2rem;"></div>

</div>

</head>

<body>

<!-- NAVIGATION -->
<header>
  <nav class="nav">
    <div class="logo">
      <div class="logo-icon">JD</div>
      <span>JaalibaDaily</span>
    </div>

    <div class="nav-right" id="navRight"></div>
  </nav>
</header>

<div class="container">

  <h2 class="center">Rechercher un trajet</h2>

  <form id="searchForm" class="form-card">

    <div>
      <label>Départ</label>
      <input id="from" type="text" placeholder="Matoto, Cosa, Kipé...">
    </div>

    <div>
      <label>Arrivée</label>
      <input id="to" type="text" placeholder="Kaloum, Lambanyi, Sonfonia...">
    </div>

    <div>
      <label>Date</label>
      <input id="date" type="date">
    </div>

    <button class="btn btn-primary" type="button" onclick="searchTrips()">Rechercher</button>

  </form>

  <div id="results" class="results"></div>

</div>

<script>
// Vérifier si utilisateur est connecté
let currentUser = JSON.parse(localStorage.getItem("currentUser"));
if (!currentUser) {
  alert("Vous devez être connecté pour rechercher un trajet.");
  window.location.href = "connexion.html";
}

// Charger les trajets
let trips = JSON.parse(localStorage.getItem("trips")) || [];

/* --- Recherche --- */
function searchTrips() {
  const from = document.getElementById("from").value.trim().toLowerCase();
  const to = document.getElementById("to").value.trim().toLowerCase();
  const date = document.getElementById("date").value;

  let results = trips.filter(t => {
    return (
      (from === "" || t.from.toLowerCase().includes(from)) &&
      (to === "" || t.to.toLowerCase().includes(to)) &&
      (date === "" || t.date === date)
    );
  });

  displayResults(results);
}

/* --- Affichage des résultats --- */
function displayResults(list) {
  const container = document.getElementById("results");
  container.innerHTML = "";

  if (list.length === 0) {
    container.innerHTML = "<p>Aucun trajet trouvé.</p>";
    return;
  }

  list.forEach(t => {
    container.innerHTML += `
      <div class="trip-card">
        <div class="trip-header">${t.from} → ${t.to}</div>
        <div class="trip-meta">
          Date : ${t.date}<br>
          Places : ${t.seats}<br>
          Prix : ${t.price} GNF<br>
          Conducteur : ${t.owner}
        </div>

        <button class="btn btn-primary reserve-btn" onclick="reserve(${t.id})">
          Réserver ce trajet
        </button>
      </div>
    `;
  });
}

/* --- Réserver un trajet --- */
function reserve(id) {
  let bookings = JSON.parse(localStorage.getItem("bookings")) || [];

  // vérifier si déjà réservé
  if (bookings.some(b => b.tripId === id && b.user === currentUser.email)) {
    alert("Vous avez déjà réservé ce trajet.");
    return;
  }

  bookings.push({
    bookingId: Date.now(),
    tripId: id,
    user: currentUser.email
  });

  localStorage.setItem("bookings", JSON.stringify(bookings));

  alert("Trajet réservé avec succès !");
}
</script>

<!-- BARRE DE NAVIGATION DYNAMIQUE -->
<script>
document.addEventListener("DOMContentLoaded", () => {
    const navRight = document.getElementById("navRight");
    const user = JSON.parse(localStorage.getItem("currentUser"));

    if (!user) {
        navRight.innerHTML = `
            <a href="connexion.html">Connexion</a>
            <a href="inscription.html">Créer un compte</a>
        `;
    } else {
        navRight.innerHTML = `
            <a href="index.html">Accueil</a>
            <a href="recherche.html">Rechercher</a>
            <a href="proposer.html">Proposer</a>
            <a href="mes-reservations.html">Mes réservations</a>
            <a href="profil.html">Profil</a>
            <button id="logoutBtn">Se déconnecter</button>
        `;
    }

    const logoutBtn = document.getElementById("logoutBtn");
    if (logoutBtn) {
        logoutBtn.addEventListener("click", () => {
            localStorage.removeItem("currentUser");
            window.location.href = "index.html";
        });
    }
});
</script>

</body>
</html>
